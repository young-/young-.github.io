<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Kubernetes 1.11.3 安装 | 天青色等烟雨</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.2"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-87247047-1','auto');ga('send','pageview');</script><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({google_ad_client: "ca-pub-8363937384673482", enable_page_level_ads: true});</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Kubernetes 1.11.3 安装</h1><a id="logo" href="/.">天青色等烟雨</a><p class="description">文不在多、有换则新、人不在挤、有来就行</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Kubernetes 1.11.3 安装</h1><div class="post-meta">Sep 27, 2018<span> | </span><span class="category"><a href="/categories/Kubernetes/">Kubernetes</a></span></div><div class="post-content"><p>Kubernetes 1.11.3 发布，容器编排工具</p>
<a id="more"></a>
<p><ul class="markdownIt-TOC">
<li><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96">初始化</a>
<ul>
<li><a href="#%E8%AE%BE%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D">设置主机名</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE-dns">配置 dns</a></li>
<li><a href="#%E5%81%9C%E6%AD%A2%E9%98%B2%E7%81%AB%E5%A2%99">停止防火墙</a></li>
<li><a href="#%E5%85%B3%E9%97%ADswap">关闭Swap</a></li>
<li><a href="#selinux">Selinux</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE-dns-2">配置 dns</a></li>
<li><a href="#%E4%BF%AE%E6%94%B9%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0">修改内核参数</a></li>
</ul>
</li>
<li><a href="#k8s-rpm-install">k8s rpm install</a></li>
<li><a href="#%E5%85%B3%E4%BA%8E-kubelet-cgroup-driver">关于 kubelet cgroup driver</a></li>
<li><a href="#%E5%87%86%E5%A4%87%E9%95%9C%E5%83%8F">准备镜像</a></li>
<li><a href="#kube-proxy-%E4%BD%BF%E7%94%A8-ipvs-%E6%A8%A1%E5%BC%8F">kube-proxy 使用 ipvs 模式</a></li>
<li><a href="#kubeadm-init-%E5%88%9D%E5%A7%8B%E5%8C%96">Kubeadm Init 初始化</a></li>
<li><a href="#%E5%8D%B8%E8%BD%BD-kubeadm-%E5%AE%89%E8%A3%85">卸载 kubeadm 安装</a></li>
<li><a href="#%E9%AA%8C%E8%AF%81%E9%9B%86%E7%BE%A4">验证集群</a></li>
<li><a href="#%E5%AE%89%E8%A3%85calico%E7%BD%91%E7%BB%9C">安装calico网络</a></li>
<li><a href="#%E5%8E%BB%E9%99%A4%E5%AF%B9master%E7%9A%84%E8%B0%83%E5%BA%A6%E9%9A%94%E7%A6%BB">去除对master的调度隔离</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E6%B5%8B%E8%AF%95">部署服务测试</a></li>
<li><a href="#hairpin-mode">Hairpin Mode</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E8%8A%82%E7%82%B9">添加节点</a></li>
</ul>
</p>
<h2><span id="初始化"> 初始化</span></h2>
<h3><span id="设置主机名"> 设置主机名</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl  set-hostname docker01</span><br></pre></td></tr></table></figure>
<h3><span id="配置-dns"> 配置 dns</span></h3>
<blockquote>
<p>echo nameserver 114.114.114.114&gt;&gt;/etc/resolv.conf</p>
</blockquote>
<h3><span id="停止防火墙"> 停止防火墙</span></h3>
<p>systemctl disable firewalld &amp;&amp; systemctl stop firewalld &amp;&amp; systemctl status firewalld</p>
<h3><span id="关闭swap"> 关闭Swap</span></h3>
<blockquote>
<p>swapoff -a<br>
sed  ‘s/.<em>swap.</em>/#&amp;/’ /etc/fstab</p>
</blockquote>
<h3><span id="selinux"> Selinux</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ -f /etc/selinux/config ] &amp;&amp; sed -i &apos;s/^SELINUX=.*/SELINUX=disabled/g&apos; /etc/selinux/config</span><br><span class="line">[ -f /etc/sysconfig/selinux ] &amp;&amp; sed -i &apos;s/^SELINUX=.*/SELINUX=disabled/g&apos; /etc/sysconfig/selinux</span><br><span class="line">[ -x /usr/sbin/setenforce ] &amp;&amp; /usr/sbin/setenforce 0</span><br></pre></td></tr></table></figure>
<h3><span id="配置-dns"> 配置 dns</span></h3>
<blockquote>
<p>echo nameserver 114.114.114.114&gt;&gt;/etc/resolv.conf</p>
</blockquote>
<h3><span id="修改内核参数"> 修改内核参数</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">vm.swappiness=0</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sysctl -p /etc/sysctl.d/k8s.conf</span><br><span class="line"></span><br><span class="line">echo 1 &gt; /proc/sys/net/bridge/bridge-nf-call-iptables</span><br><span class="line">echo 1 &gt; /proc/sys/net/bridge/bridge-nf-call-ip6tables</span><br></pre></td></tr></table></figure>
<p><code>swapoff -a</code></p>
<h2><span id="k8s-rpm-install"> k8s rpm install</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http://yum.kubernetes.io/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg</span><br><span class="line">       https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">指定版本下载安装：</span><br><span class="line">离线下载rpm包</span><br><span class="line">mkdir k8srpm &amp;&amp; cd k8srpm</span><br><span class="line">yum install -y yum-utils</span><br><span class="line">yumdownloader kubectl-1.11.3 kubelet-1.11.3 kubeadm-1.11.3  kubernetes-cni</span><br><span class="line"></span><br><span class="line">yum install  ./*.rpm -y</span><br><span class="line"></span><br><span class="line">systemctl enable kubelet.service</span><br></pre></td></tr></table></figure>
<h2><span id="关于-kubelet-cgroup-driver"> 关于 kubelet cgroup driver</span></h2>
<p>当前版本，使用Docker时，kubeadm会自动检测<code>kubelet</code>的cgroup驱动程序，并在运行时将其设置在<code>/var/lib/kubelet/kubeadm-flags.env</code>文件中。</p>
<p>因此，无需修改 kubelet cgroup driver</p>
<h2><span id="准备镜像"> 准备镜像</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker pull k8s.gcr.io/kube-apiserver-amd64:v1.11.3</span><br><span class="line">docker pull k8s.gcr.io/kube-controller-manager-amd64:v1.11.3</span><br><span class="line">docker pull k8s.gcr.io/kube-proxy-amd64:v1.11.3</span><br><span class="line">docker pull k8s.gcr.io/kube-scheduler-amd64:v1.11.3</span><br><span class="line">docker pull k8s.gcr.io/pause:3.1</span><br><span class="line">docker pull k8s.gcr.io/coredns:1.1.3</span><br><span class="line">docker pull quay.io/calico/node:v3.1.3</span><br><span class="line">docker pull quay.io/calico/cni:v3.1.3</span><br><span class="line">docker pull k8s.gcr.io/etcd-amd64:3.2.18</span><br></pre></td></tr></table></figure>
<h2><span id="kube-proxy-使用-ipvs-模式"> kube-proxy 使用 ipvs 模式</span></h2>
<ol>
<li>对于Kubernetes v1.10及更高版本，功能门默认 <code>SupportIPVSProxyMode</code>设置为<code>true</code>。但是，在v1.10之前版本用您需要 <code>--feature-gates=SupportIPVSProxyMode=true</code> 。</li>
<li>指定 <code>proxy-mode=ipvs</code></li>
<li>安装需要的内核模块和软件包</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">安装</span><br><span class="line">yum install ipvsadm -y</span><br><span class="line">加载</span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack_ipv4</span><br><span class="line">检查</span><br><span class="line">cut -f1 -d &quot; &quot;  /proc/modules | grep -e ip_vs -e nf_conntrack_ipv4</span><br><span class="line">输出</span><br><span class="line">ip_vs_sh</span><br><span class="line">ip_vs_wrr</span><br><span class="line">ip_vs_rr</span><br><span class="line">nf_conntrack_ipv4</span><br><span class="line">ip_vs</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://github.com/kubernetes/kubernetes/tree/master/pkg/proxy/ipvs" target="_blank" rel="noopener">详细IPVS</a></p>
</blockquote>
<blockquote>
<p><a href="https://blog.csdn.net/cloudvtech/article/details/79942121" target="_blank" rel="noopener">kubernetes系列之六：安装kubernets v1.10.0和ipvs mode kube-proxy</a></p>
</blockquote>
<h2><span id="kubeadm-init-初始化"> Kubeadm Init 初始化</span></h2>
<p><a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-init/#config-file" target="_blank" rel="noopener">将kubeadm init与配置文件一起使用</a></p>
<p><code>kubeadm init</code>使用配置文件而不是命令行标志进行配置，而某些更高级的功能可能仅作为配置文件选项提供。该文件在–config选项中传递。</p>
<p>在<code>Kubernetes 1.11</code>及更高版本中，可以使用<mark>kubeadm config print-default</mark>命令打印出默认配置 。这是建议您在旧迁移v1alpha1配置v1alpha2使用kubeadm配置迁移命令，因为v1alpha1会在Kubernetes 1.12被删除。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># cat kubeadm-init.conf</span><br><span class="line">apiVersion: kubeadm.k8s.io/v1alpha2</span><br><span class="line">certificatesDir: /etc/kubernetes/pki</span><br><span class="line">clusterName: kubernetes</span><br><span class="line">imageRepository: k8s.gcr.io</span><br><span class="line">kind: MasterConfiguration</span><br><span class="line">api:</span><br><span class="line">  advertiseAddress: 192.168.1.241</span><br><span class="line">  bindPort: 6443</span><br><span class="line">  controlPlaneEndpoint: &quot;&quot;</span><br><span class="line">kubeProxy:</span><br><span class="line">  config:</span><br><span class="line">    mode: &quot;ipvs&quot;</span><br><span class="line">kubeletConfiguration:</span><br><span class="line">  baseConfig:</span><br><span class="line">    clusterDNS:</span><br><span class="line">    - 10.96.0.10</span><br><span class="line">    clusterDomain: cluster.local</span><br><span class="line">kubernetesVersion: v1.11.3</span><br><span class="line">networking:</span><br><span class="line">  dnsDomain: cluster.local</span><br><span class="line">  podSubnet: &quot;10.42.0.0/16&quot;</span><br><span class="line">  serviceSubnet: 10.96.0.0/12</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里没有配置etcd ，<code>kubeadm init</code> 自动安装etcd。<br>
Kubeadm默认在mater节点上的kubelet管理的静态pod中运行单节点的etcd集群。这不是高可用性设置，因为etcd集群只包含一个成员，并且无法维持任何成员变得不可用。</p>
</blockquote>
<p>以上主要修改2点：</p>
<ol>
<li>kubeProxy 启用 ipvs</li>
<li>指定 pod 子网段为 <code>10.42.0.0/16</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"># kubeadm init --config kubeadm-init.conf  </span><br><span class="line">[init] using Kubernetes version: v1.11.3</span><br><span class="line">[preflight] running pre-flight checks</span><br><span class="line">I0920 15:57:53.117081   30624 kernel_validator.go:81] Validating kernel version</span><br><span class="line">I0920 15:57:53.117279   30624 kernel_validator.go:96] Validating kernel config</span><br><span class="line">[preflight/images] Pulling images required for setting up a Kubernetes cluster</span><br><span class="line">[preflight/images] This might take a minute or two, depending on the speed of your internet connection</span><br><span class="line">[preflight/images] You can also perform this action in beforehand using &apos;kubeadm config images pull&apos;</span><br><span class="line">[kubelet] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span><br><span class="line">[kubelet] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;</span><br><span class="line">[preflight] Activating the kubelet service</span><br><span class="line">[certificates] Generated ca certificate and key.</span><br><span class="line">[certificates] Generated apiserver certificate and key.</span><br><span class="line">[certificates] apiserver serving cert is signed for DNS names [localhost.localdomain kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.1.241]</span><br><span class="line">[certificates] Generated apiserver-kubelet-client certificate and key.</span><br><span class="line">[certificates] Generated sa key and public key.</span><br><span class="line">[certificates] Generated front-proxy-ca certificate and key.</span><br><span class="line">[certificates] Generated front-proxy-client certificate and key.</span><br><span class="line">[certificates] Generated etcd/ca certificate and key.</span><br><span class="line">[certificates] Generated etcd/server certificate and key.</span><br><span class="line">[certificates] etcd/server serving cert is signed for DNS names [localhost.localdomain localhost] and IPs [127.0.0.1 ::1]</span><br><span class="line">[certificates] Generated etcd/peer certificate and key.</span><br><span class="line">[certificates] etcd/peer serving cert is signed for DNS names [localhost.localdomain localhost] and IPs [192.168.1.241 127.0.0.1 ::1]</span><br><span class="line">[certificates] Generated etcd/healthcheck-client certificate and key.</span><br><span class="line">[certificates] Generated apiserver-etcd-client certificate and key.</span><br><span class="line">[certificates] valid certificates and keys now exist in &quot;/etc/kubernetes/pki&quot;</span><br><span class="line">[kubeconfig] Wrote KubeConfig file to disk: &quot;/etc/kubernetes/admin.conf&quot;</span><br><span class="line">[kubeconfig] Wrote KubeConfig file to disk: &quot;/etc/kubernetes/kubelet.conf&quot;</span><br><span class="line">[kubeconfig] Wrote KubeConfig file to disk: &quot;/etc/kubernetes/controller-manager.conf&quot;</span><br><span class="line">[kubeconfig] Wrote KubeConfig file to disk: &quot;/etc/kubernetes/scheduler.conf&quot;</span><br><span class="line">[controlplane] wrote Static Pod manifest for component kube-apiserver to &quot;/etc/kubernetes/manifests/kube-apiserver.yaml&quot;</span><br><span class="line">[controlplane] wrote Static Pod manifest for component kube-controller-manager to &quot;/etc/kubernetes/manifests/kube-controller-manager.yaml&quot;</span><br><span class="line">[controlplane] wrote Static Pod manifest for component kube-scheduler to &quot;/etc/kubernetes/manifests/kube-scheduler.yaml&quot;</span><br><span class="line">[etcd] Wrote Static Pod manifest for a local etcd instance to &quot;/etc/kubernetes/manifests/etcd.yaml&quot;</span><br><span class="line">[init] waiting for the kubelet to boot up the control plane as Static Pods from directory &quot;/etc/kubernetes/manifests&quot; </span><br><span class="line">[init] this might take a minute or longer if the control plane images have to be pulled</span><br><span class="line">[apiclient] All control plane components are healthy after 49.001944 seconds</span><br><span class="line">[uploadconfig] storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace</span><br><span class="line">[kubelet] Creating a ConfigMap &quot;kubelet-config-1.11&quot; in namespace kube-system with the configuration for the kubelets in the cluster</span><br><span class="line">[markmaster] Marking the node localhost.localdomain as master by adding the label &quot;node-role.kubernetes.io/master=&apos;&apos;&quot;</span><br><span class="line">[markmaster] Marking the node localhost.localdomain as master by adding the taints [node-role.kubernetes.io/master:NoSchedule]</span><br><span class="line">[patchnode] Uploading the CRI Socket information &quot;/var/run/dockershim.sock&quot; to the Node API object &quot;localhost.localdomain&quot; as an annotation</span><br><span class="line">[bootstraptoken] using token: wadx1n.9gfusllys13qk1yj</span><br><span class="line">[bootstraptoken] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials</span><br><span class="line">[bootstraptoken] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span><br><span class="line">[bootstraptoken] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster</span><br><span class="line">[bootstraptoken] creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace</span><br><span class="line">[addons] Applied essential addon: CoreDNS</span><br><span class="line">[addons] Applied essential addon: kube-proxy</span><br><span class="line"></span><br><span class="line">Your Kubernetes master has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  mkdir -p $HOME/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">You can now join any number of machines by running the following on each node</span><br><span class="line">as root:</span><br><span class="line"></span><br><span class="line">  kubeadm join 192.168.1.241:6443 --token se4mgd.ukmg2hxxg42gt65t --discovery-token-ca-cert-hash sha256:0a737675e1e37aa4025077b27ced8053fe84c363df11c506bfb512b88408697e</span><br></pre></td></tr></table></figure>
<p>启动完毕</p>
<h2><span id="卸载-kubeadm-安装"> 卸载 kubeadm 安装</span></h2>
<p>要撤消kubeadm所执行的操作，您应首先排空节点，并确保节点在关闭之前为空。</p>
<p>使用适当的凭据与主人交谈，运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl drain &lt;node name&gt; --delete-local-data --force --ignore-daemonsets</span><br><span class="line">kubectl delete node &lt;node name&gt;</span><br></pre></td></tr></table></figure>
<p>然后，在要删除的节点上，重置所有kubeadm安装状态：</p>
<p><code>kubeadm reset</code></p>
<p>如果您希望重新开始，只需运行<code>kubeadm init</code>或<code>kubeadm join</code>使用适当的参数。</p>
<h2><span id="验证集群"> 验证集群</span></h2>
<ol>
<li>按照提示，复制配置文件</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"></span><br><span class="line"># kubectl  -n kube-system get po -o wide</span><br><span class="line">NAME                             READY     STATUS    RESTARTS   AGE       IP              NODE      NOMINATED NODE</span><br><span class="line">coredns-78fcdf6894-2p6gp         0/1       Pending   0          2m        &lt;none&gt;          &lt;none&gt;    &lt;none&gt;</span><br><span class="line">coredns-78fcdf6894-wnz4p         0/1       Pending   0          2m        &lt;none&gt;          &lt;none&gt;    &lt;none&gt;</span><br><span class="line">etcd-test01                      1/1       Running   0          1m        192.168.1.241   test01    &lt;none&gt;</span><br><span class="line">kube-apiserver-test01            1/1       Running   0          1m        192.168.1.241   test01    &lt;none&gt;</span><br><span class="line">kube-controller-manager-test01   1/1       Running   0          1m        192.168.1.241   test01    &lt;none&gt;</span><br><span class="line">kube-proxy-8wjp8                 1/1       Running   0          2m        192.168.1.241   test01    &lt;none&gt;</span><br><span class="line">kube-scheduler-test01            1/1       Running   0          1m        192.168.1.241   test01    &lt;none&gt;</span><br></pre></td></tr></table></figure>
<p>由于还没有部署网络，<code>coredns</code> 处于 <code>Pending</code> 状态。</p>
<ol start="2">
<li>验证 cgroup-driver 与 docker cgroup-driver 是否匹配：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cat /var/lib/kubelet/kubeadm-flags.env</span><br><span class="line">KUBELET_KUBEADM_ARGS=--cgroup-driver=systemd --cni-bin-dir=/opt/cni/bin --cni-conf-dir=/etc/cni/net.d --network-plugin=cni</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>验证 kube-proxy IPVS 模式</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ipvsadm -L -n</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">TCP  10.96.0.1:443 rr</span><br><span class="line">  -&gt; 192.168.1.241:6443           Masq    1      0          0         </span><br><span class="line">TCP  10.96.0.10:53 rr</span><br><span class="line">UDP  10.96.0.10:53 rr</span><br></pre></td></tr></table></figure>
<h2><span id="安装calico网络"> 安装calico网络</span></h2>
<p><a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#pod-network" target="_blank" rel="noopener">安装pod网络附加组件</a></p>
<p>有关使用Calico的更多信息，请参阅Kubernetes上的 Calico 快速入门，为策略和网络安装Calico以及其他相关资源。</p>
<p>calico 默认pod网络为<code>192.168.0.0/16</code>, 上面kubeadm初始化时指定了 <code>networking.podSubnet: &quot;10.42.0.0/16&quot;</code> 。<br>
这里需要修改<code>calico.yaml</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">加载rbac策略</span><br><span class="line">kubectl apply -f https://docs.projectcalico.org/v3.1/getting-started/kubernetes/installation/hosted/rbac-kdd.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">修改 CALICO_IPV4POOL_CIDR</span><br><span class="line">wget https://docs.projectcalico.org/v3.1/getting-started/kubernetes/installation/hosted/kubernetes-datastore/calico-networking/1.7/calico.yaml</span><br><span class="line">sed -i &apos;s/192.168.0.0/10.42.0.0/g&apos; calico.yaml</span><br><span class="line">grep 0.0 calico.yaml </span><br><span class="line"></span><br><span class="line">kubectl apply -f calico.yaml</span><br></pre></td></tr></table></figure>
<p>查看容器状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># kubectl  -n kube-system get po -o wide</span><br><span class="line">NAME                             READY     STATUS    RESTARTS   AGE       IP              NODE      NOMINATED NODE</span><br><span class="line">calico-node-sfxvc                2/2       Running   0          32s       192.168.1.241   test01    &lt;none&gt;</span><br><span class="line">coredns-78fcdf6894-2p6gp         1/1       Running   0          28m       10.42.0.2       test01    &lt;none&gt;</span><br><span class="line">coredns-78fcdf6894-wnz4p         1/1       Running   0          28m       10.42.0.3       test01    &lt;none&gt;</span><br><span class="line">etcd-test01                      1/1       Running   0          27m       192.168.1.241   test01    &lt;none&gt;</span><br><span class="line">kube-apiserver-test01            1/1       Running   0          27m       192.168.1.241   test01    &lt;none&gt;</span><br><span class="line">kube-controller-manager-test01   1/1       Running   0          27m       192.168.1.241   test01    &lt;none&gt;</span><br><span class="line">kube-proxy-8wjp8                 1/1       Running   0          28m       192.168.1.241   test01    &lt;none&gt;</span><br><span class="line">kube-scheduler-test01            1/1       Running   0          27m       192.168.1.241   test01    &lt;none&gt;</span><br></pre></td></tr></table></figure>
<p>增加了一个 <code>calico</code> 容器，<code>coredns</code> 启动成功。</p>
<p>查看 ipvs 列表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># ipvsadm -L -n</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">TCP  10.96.0.1:443 rr</span><br><span class="line">  -&gt; 192.168.1.241:6443           Masq    1      4          0         </span><br><span class="line">TCP  10.96.0.10:53 rr</span><br><span class="line">  -&gt; 10.42.0.2:53                 Masq    1      0          0         </span><br><span class="line">  -&gt; 10.42.0.3:53                 Masq    1      0          0         </span><br><span class="line">TCP  10.99.127.226:5473 rr</span><br><span class="line">UDP  10.96.0.10:53 rr</span><br><span class="line">  -&gt; 10.42.0.2:53                 Masq    1      0          0         </span><br><span class="line">  -&gt; 10.42.0.3:53                 Masq    1      0          0</span><br></pre></td></tr></table></figure>
<h2><span id="去除对master的调度隔离"> 去除对master的调度隔离</span></h2>
<p>默认情况下，出于安全原因，您的群集不会在<code>master</code>服务器上安排容器。如果您希望能够在<code>master</code>服务器上安排<code>pod</code>，例如，对于用于开发的单机<code>Kubernetes</code>集群，请运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># kubectl taint nodes --all node-role.kubernetes.io/master-</span><br><span class="line">node/test01 untainted</span><br></pre></td></tr></table></figure>
<p>这将从<code>node-role.kubernetes.io/master</code>包含主节点的任何节点中删除<code>taint</code>，这意味着调度程序将能够在任何地方安排<code>pod</code>。</p>
<h2><span id="部署服务测试"> 部署服务测试</span></h2>
<blockquote>
<p>cloudnativelabs/whats-my-ip 是一个每次请求，返回当前主机的主机名和IP的服务</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run myip --image=cloudnativelabs/whats-my-ip --replicas=3 --port=8080</span><br></pre></td></tr></table></figure>
<p>创建一个服务，类型为NodePort</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl expose deployment myip --port=8080 --target-port=8080 --type=NodePort</span><br></pre></td></tr></table></figure>
<p>启动一个busybox镜像容器 用于测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run tools --image=byrnedo/alpine-curl --replicas=1 --command -- sleep 99999999</span><br></pre></td></tr></table></figure>
<p>查看服务状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># kubectl  get po -o wide</span><br><span class="line">NAME                     READY     STATUS    RESTARTS   AGE       IP           NODE      NOMINATED NODE</span><br><span class="line">myip-5fc5cf6476-cfwjn    1/1       Running   0          15m       10.42.0.7    test01    &lt;none&gt;</span><br><span class="line">myip-5fc5cf6476-g55f7    1/1       Running   0          15m       10.42.0.8    test01    &lt;none&gt;</span><br><span class="line">myip-5fc5cf6476-wvxvt    1/1       Running   0          15m       10.42.0.6    test01    &lt;none&gt;</span><br><span class="line">tools-7c7dcbc894-74m6z   1/1       Running   0          1m        10.42.0.10   test01    &lt;none&gt;</span><br><span class="line"></span><br><span class="line">[root@test01 ~]# kubectl  get svc</span><br><span class="line">NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">kubernetes   ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP          17h</span><br><span class="line">myip         NodePort    10.101.143.54   &lt;none&gt;        8080:30319/TCP   3m</span><br></pre></td></tr></table></figure>
<p>测试myip服务状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># kubectl  exec -it tools-7c7dcbc894-74m6z  /bin/sh</span><br><span class="line">测试 dns 是否正常解析</span><br><span class="line">/ # nslookup myip</span><br><span class="line">Server:    10.96.0.10</span><br><span class="line">Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local</span><br><span class="line"></span><br><span class="line">Name:      myip</span><br><span class="line">Address 1: 10.101.143.54 myip.default.svc.cluster.local</span><br><span class="line">访问服务测试，连续访问十次</span><br><span class="line">/ # for i in $(seq 1 10);do curl myip:8080 ;done</span><br><span class="line">HOSTNAME:myip-5fc5cf6476-cfwjn IP:10.42.0.7</span><br><span class="line">HOSTNAME:myip-5fc5cf6476-wvxvt IP:10.42.0.6</span><br><span class="line">HOSTNAME:myip-5fc5cf6476-g55f7 IP:10.42.0.8</span><br><span class="line">HOSTNAME:myip-5fc5cf6476-cfwjn IP:10.42.0.7</span><br><span class="line">HOSTNAME:myip-5fc5cf6476-wvxvt IP:10.42.0.6</span><br><span class="line">HOSTNAME:myip-5fc5cf6476-g55f7 IP:10.42.0.8</span><br><span class="line">HOSTNAME:myip-5fc5cf6476-cfwjn IP:10.42.0.7</span><br><span class="line">HOSTNAME:myip-5fc5cf6476-wvxvt IP:10.42.0.6</span><br><span class="line">HOSTNAME:myip-5fc5cf6476-g55f7 IP:10.42.0.8</span><br><span class="line">HOSTNAME:myip-5fc5cf6476-cfwjn IP:10.42.0.7</span><br></pre></td></tr></table></figure>
<h2><span id="hairpin-mode"> Hairpin Mode</span></h2>
<p>许多网络附加组件尚未启用<code>Hairpin</code>模式 ，<code>Hairpin</code>模式允许pod通过其服务IP访问自己。这是与CNI相关的问题 。请联系网络附加提供商以获取他们对发夹模式支持的最新状态。</p>
<p>calico 网络经过以上测试，pod可以通过其服务IP访问自己，无需配置 <code>Hairpin Mode</code> .</p>
<h2><span id="添加节点"> 添加节点</span></h2>
<p>节点是运行工作负载（容器和容器等）的位置。要向群集添加新节点，先执行以上的准备工作</p>
<p>然后执行 <code>master</code> 节点 <code>kubeadm init</code> 输出的最后一句, 即可加入集群：</p>
<p><code>kubeadm join 192.168.1.241:6443 --token se4mgd.ukmg2hxxg42gt65t --discovery-token-ca-cert-hash sha256:0a737675e1e37aa4025077b27ced8053fe84c363df11c506bfb512b88408697e</code></p>
<p><strong>如果不知道以上命令，怎么查询 token 和 discovery-token-ca-cert-has 呢？</strong></p>
<ol>
<li>如果没有<code>token</code>，执行以下查询获得</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># kubeadm token list</span><br><span class="line">TOKEN                     TTL       EXPIRES                     USAGES                   DESCRIPTION   EXTRA GROUPS</span><br><span class="line">se4mgd.ukmg2hxxg42gt65t   5h        2018-09-21T17:32:06+08:00   authentication,signing   &lt;none&gt;        system:bootstrappers:kubeadm:default-node-token</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>默认情况下，令牌在24小时后过期。如果在当前令牌过期后将节点加入群集，则可以通过在主节点上运行以下命令来创建新令牌：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># kubeadm token create</span><br><span class="line">ih6qhw.tbkp26l64xivcca7</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>如果没有<code>discovery-token-ca-cert-hash</code>,执行以下查询获得。<br>
<code>--discovery-token-ca-cert-hash</code> 的值可以配合多个<code>token</code>以重复使用。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | \</span><br><span class="line">&gt;    openssl dgst -sha256 -hex | sed &apos;s/^.* //&apos;</span><br><span class="line">0a737675e1e37aa4025077b27ced8053fe84c363df11c506bfb512b88408697e</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>通过创建新的token时，打印 join 命令：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># kubeadm token create --print-join-command</span><br><span class="line">kubeadm join 192.168.1.241:6443 --token 771jdx.k0jtjvzgfiu8k4uv --discovery-token-ca-cert-hash sha256:0a737675e1e37aa4025077b27ced8053fe84c363df11c506bfb512b88408697e</span><br></pre></td></tr></table></figure>
<p>几秒钟后，您应该注意到kubectl get nodes在master服务器上运行时输出中的此节点。</p>
<p><a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-join/" target="_blank" rel="noopener">kubeadm join 详细</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.2" async></script><a class="article-share-link" data-url="yunke.science/2018/09/27/k8s-1-11-install/" data-id="cjojg9swi002b40vhwno04zgy" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAABxklEQVR42u3aS27DMAwFwNz/0i7QrWH1kYpYL0arIm6sURYEP/p84nX9rvsn93X//6en93d+beHi4m5zr+Vab/+08RWv3ICLizvPXQev9QGqMefp/UkAxcXFfRs3+VaSxOSHx8XFfT83T02qBRUuLu47uXlxkh81CXYHazVcXNwN7k7Q+dbfB/u7uLi4Re5VXNVjrANfeXdcXNwRbrXlkTdAq62QwttwcXFHuDtDlF7RsvMUFxd3hpuPS08UPHkyhIuLO8Pdb4nmHYwkqYpqNVxc3MPcfOyRJ0DrxCiHRkNWXFzcY9ze5KLXRukdGxcXd57bK34SSn71KqHj4uLOcHc2Xh/gRAmEi4s7w81TjWpLtFcgRUEQFxf3MLdatHxrvNq8zoWLizvCrbYkCgOP1mWO6AC4uLiHueWbGsWkp3fB63EXXFzcQe4nXslLe0OXQiDDxcUd4earN1jNL1780WbFxcUd4VZDWDWc5cXVTpqFi4t7gpuEnt5m1ZQoSpVwcXEHudXLWDPFT+ExLi7uP3Grx6he+YpyMVxc3FdyqwVSDkpSK1xc3EluUvzsN0/3MxZcXNwZbq9hmg9ik58geQMuLu4I9wcQ5gYcmvLZGwAAAABJRU5ErkJggg==">分享</a><div class="tags"><a href="/tags/Kubernetes/">Kubernetes</a></div><div class="post-nav"><a class="pre" href="/2018/09/27/k8s-1-11-3-etcd/">Kubernetes 1.11.3 使用kubeadm创建高可用的ETCD群集</a><a class="next" href="/2018/09/19/cka-faq/">CKA常见问题解答</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.2"><script src="/js/gitment.browser.js?v=0.0.2"></script><script>var gitment = new Gitment({
  owner: 'young-0',
  repo: 'young-0.github.io',
  oauth: {
    client_id: '967eeda5599f16063a0a',
    client_secret: '0c5aaeec2649210043608d7a09c7d19f0795f3f9',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="yunke.science"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kubernetes/">Kubernetes</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/elk/">elk</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/fiction/">fiction</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jenkins/">jenkins</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/monitor/">monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/其他/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络/">网络</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/美文/">美文</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/monitor/" style="font-size: 15px;">monitor</a> <a href="/tags/elk/" style="font-size: 15px;">elk</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/traefik/" style="font-size: 15px;">traefik</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/openresty/" style="font-size: 15px;">openresty</a> <a href="/tags/LuaRocks/" style="font-size: 15px;">LuaRocks</a> <a href="/tags/fiction/" style="font-size: 15px;">fiction</a> <a href="/tags/架构/" style="font-size: 15px;">架构</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/Kubernetes/" style="font-size: 15px;">Kubernetes</a> <a href="/tags/crond/" style="font-size: 15px;">crond</a> <a href="/tags/alpine/" style="font-size: 15px;">alpine</a> <a href="/tags/网络/" style="font-size: 15px;">网络</a> <a href="/tags/kubernetes/" style="font-size: 15px;">kubernetes</a> <a href="/tags/kcptun/" style="font-size: 15px;">kcptun</a> <a href="/tags/zabbix/" style="font-size: 15px;">zabbix</a> <a href="/tags/美文/" style="font-size: 15px;">美文</a> <a href="/tags/情商/" style="font-size: 15px;">情商</a> <a href="/tags/智商/" style="font-size: 15px;">智商</a> <a href="/tags/jenkins/" style="font-size: 15px;">jenkins</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/16/k8s-pod-priority/">pod 优先级和抢占机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/05/pipeline-when/">jenkins pipeline when 内置判断条件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/24/k8s-job-monitor/">Kubernetes job monitor</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/22/expose-pod-info/">k8s通过文件将Pod信息暴露给容器的方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/29/weave-net/">weave-net</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/27/k8s-1-11-3-etcd/">Kubernetes 1.11.3 使用kubeadm创建高可用的ETCD群集</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/27/k8s-1-11-install/">Kubernetes 1.11.3 安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/19/cka-faq/">CKA常见问题解答</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/28/redis-security/">redis 安全</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/27/http2-server-push/">使用NGINX 1.13.9引入HTTP2服务器推送</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.21andy.com/manual/advanced-bash-scripting-guide/" title="高级Bash脚本编程指南" target="_blank">高级Bash脚本编程指南</a><ul></ul><a href="http://www.colasoft.com.cn/training/document.php" title="网络分析技术学习资料" target="_blank">网络分析技术学习资料</a><ul></ul><a href="https://k8smeetup.github.io/docs/home/" title="Kubernetes文档" target="_blank">Kubernetes文档</a><ul></ul><a href="https://www.bilibili.com/video/av21179285" title="TCPIP协议详解" target="_blank">TCPIP协议详解</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">天青色等烟雨.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.2" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.2" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" color="0,0,0" opacity="0.5" zIndex="-2" count="50" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.2"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.2"></script></div></body></html>