<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>filebeat 5.+ 与 6.+ 版本的主要更改 | 天青色等烟雨</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.2"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-87247047-1','auto');ga('send','pageview');</script><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({google_ad_client: "ca-pub-8363937384673482", enable_page_level_ads: true});</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">filebeat 5.+ 与 6.+ 版本的主要更改</h1><a id="logo" href="/.">天青色等烟雨</a><p class="description">文不在多、有换则新、人不在挤、有来就行</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">filebeat 5.+ 与 6.+ 版本的主要更改</h1><div class="post-meta">May 4, 2018<span> | </span><span class="category"><a href="/categories/elk/">elk</a></span></div><div class="post-content"><p>本节讨论如果将Beats从版本5.x升级到6.x时应注意的主要更改.</p>
<a id="more"></a>
<p>@[TOC]</p>
<p><a href="https://www.elastic.co/guide/en/beats/libbeat/master/breaking-changes-6.0.html" target="_blank" rel="noopener">Beats Platform Reference [master] » Breaking changes » Breaking changes in 6.0</a></p>
<h2><span id="spooler-组件删除">Spooler 组件删除</span></h2><p><a href="https://www.elastic.co/guide/en/beats/libbeat/master/breaking-changes-6.0.html#breaking-changes-spooler-removed" target="_blank" rel="noopener">filebeat spooler removed</a></p>
<p>6.0版本为所有Beats的内部管道提供了一种新的体系结构。这种架构重构主要是内部的，但更明显的效果之一是Filebeat的Spooler组件被删除</p>
<ul>
<li><code>filebeat.spool_size</code></li>
<li><code>filebeat.publish_as</code></li>
<li><code>filebeat.idle_timeo</code></li>
<li><code>queue_size</code></li>
<li><code>bulk_queue_size</code></li>
</ul>
<p>前三个特定于<code>Filebeat</code>，而<code>queue_size</code>和<code>bulk_queue_size</code>存在于所有<code>Beats</code>中。如果设置了这些选项中的任何一个，<code>Filebeat 6.0+</code>将拒绝启动。</p>
<p>引入queue.mem设置，而不是上面的设置。如果您之前必须调整spool_size或queue_size，则可能需要在升级时调整queue.mem.events。但是，最好将queue.mem的其余部分保留为默认值，因为它们适用于所有负载。</p>
<p>publish_async选项（从5.3开始不推荐使用）被删除，因为新管道默认已经异步工作。</p>
<h2><span id="只能启用一个输出">只能启用一个输出</span></h2><p>6.0之前，您可以同时启用多个输出，但仅限于不同的类型。例如，您可以启用Elasticsearch和Logstash输出，但不能启用两个Logstash输出。</p>
<p>6.0+删除了同时启用多个输出的选项。这有助于简化管道并明确Beats中输出的范围。</p>
<p>如果您需要多个输出，您有以下选择：</p>
<ul>
<li>使用Logstash输出，然后使用Logstash将事件传送到多个输出</li>
<li>同一节点运行多个实例</li>
<li>如果您使用 <code>file or console</code> 输出进行调试，除了主输出之外，我们还建议使用<code>-d &quot;publish&quot;</code>选项，将发布的事件记录在Filebeat日志中。</li>
</ul>
<h2><span id="logstash索引设置现在需要版本">Logstash索引设置现在需要版本</span></h2><p>如果使用 <code>Logstash output</code> 将数据从<code>Beats</code>发送到<code>Logstash</code>，则需要更新<code>Logstash</code>配置中的索引设置以包含<code>Beat</code>版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    hosts =&gt; &quot;localhost:9200&quot;</span><br><span class="line">    manage_template =&gt; false</span><br><span class="line">    index =&gt; &quot;%&#123;[@metadata][beat]&#125;-%&#123;[@metadata][version]&#125;-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在6.0之前，推荐的设置是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index =&gt; &quot;%&#123;[@metadata][beat]&#125;-%&#123;+YYYY.MM.dd&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>6.0的索引模板应用于与模式 <code>[beat]-[version]-*</code> 匹配的新索引。 您必须更新您的<code>Logstash</code>配置，否则模板将不会被应用。</p>
<h2><span id="filebeat-prospector-类型-和-document-类型-的改变">Filebeat prospector 类型 和 document 类型 的改变</span></h2><p><a href="https://www.elastic.co/guide/en/beats/libbeat/master/breaking-changes-6.0.html#breaking-changes-types" target="_blank" rel="noopener">Filebeat prospector type and document type changes</a></p>
<p>来自 <code>prospector</code> 配置的 <code>document_type</code> 设置已被删除，因为<code>_type</code>概念正在从<code>Elasticsearch</code>中移除。 您可以使用自定义字段，而不是<code>document_type</code>设置。</p>
<p>这也导致了将<code>input_type</code> 重命名为<code>type</code>。 这种改变是向后兼容的，因为旧的设置仍然有效。 但是，<code>input_type</code>输出字段已重命名为<code>prospector.type</code> 。</p>
<h2><span id="在配置文件中禁用filebeat默认探勘器">在配置文件中禁用Filebeat默认探勘器</span></h2><p>Filebeat的默认启动行为（基于包含的示例配置）是读取所有匹配 <code>/var/log/*.log</code> 模式的文件。 </p>
<p>从版本6.0开始，Filebeat不会以默认配置读取任何文件。 但是，您可以轻松启用系统模块，例如使用CLI标志：</p>
<p><code>filebeat --modules = system</code></p>
<h2><span id="其他更新的设置">其他更新的设置</span></h2><p><code>outputs.elasticsearch.template.*</code> 移动到 <code>setup.template.*</code> 下面，其他保持不变。</p>
<p><code>dashboards.*</code> 移动到 <code>setup.dashboards.*</code> 下面，其他保持不变。</p>
<p>Filebeat 移除选项 <code>force_close_files</code> 和 <code>close_older</code> 。</p>
<h2><span id="导入kibana仪表板的更改">导入Kibana仪表板的更改</span></h2><p>用于在先前版本的Beats中加载Kibana仪表板的import_dashboards程序已由setup命令替换。 例如，以下命令：<br><code>./scripts/import_dashboards -user elastic -pass YOUR_PASSWORD</code><br>由以下命令代替：<br><code>./filebeat setup -E &quot;output.elasticsearch.username=elastic&quot; -E &quot;output.elasticsearch.password=YOUR_PASSWORD&quot;</code>  </p>
<p>请注意，只有在配置文件中尚未配置Elasticsearch输出的情况下才需要 <code>-E</code> 标志。</p>
<p>除了命令的更改之外，请注意，加载Kibana仪表板在6.0版本的堆栈中工作方式不同。 在6.0之前，仪表板被直接插入到.kibana Elasticsearch索引中。 从6.0开始，Beats使用Kibana服务器API。 这意味着加载仪表板的Beat需要直接访问Kibana，并且需要设置Kibana URL。 设置Kibana URL的选项是<code>setup.kibana.host</code>，您可以在配置文件中或通过<code>-E CLI</code>标志设置该选项：</p>
<p><code>./filebeat setup -E &quot;setup.kibana.host=http://kibana-host:5601&quot;</code>  </p>
<p>Kibana主机的默认值是 <code>localhost:5601</code>。</p>
<h2><span id="metricbeat过滤器重命名为处理器">Metricbeat过滤器重命名为处理器</span></h2><p>在本模块级配置的“本地”处理器过去在Metricbeat中称为过滤器，但它们提供与全局处理器相似的功能。 两者之间的显着区别在于筛选器相对于度量标准集（例如，<code>mount_point</code>）访问字段，而处理器则以其全限定名称（例如<code>system.filesystem.mount_point</code>）引用字段。</p>
<p>从版本6.0开始，筛选器将重命名为处理器，并且只能使用完全限定名称访问这些字段。</p>
<h2><span id="二进制文件是针对libc动态编译的">二进制文件是针对libc动态编译的</span></h2><p>在6.0之前，使用Cgo编译<code>Metricbeat</code> 和 <code>Packetbeat</code>，而使用纯<code>Go</code>编译器编译<code>Filebeat</code>，<code>Winlogbeat</code>和<code>Heartbeat</code>。 编译Cgo的一个优势是libc是动态编译的。 </p>
<p>从6.0开始，所有Beats都使用Cgo进行编译，因此可以针对libc进行动态编译。 这可以降低二进制文件的可移植性，但是所有受支持的平台都不受影响。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.2" async></script><a class="article-share-link" data-url="yunke.science/2018/05/04/beats56changelog/" data-id="cjspxiwoe000okgvhcl1anefp" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAABxUlEQVR42u3aS47DIBAFwNz/0pntSImd190GZ0bFysoHCi9a8ODxiNvzV3v95Kgl/32saLi4uGPuZMjX52SSR8/nBlxc3P3co8ES3GQy+W9wcXH/Ivd8Avn0cHFx/xN3svnBxcX9Tm4y5NHv8y3Q1r0aLi7ugJunlOuel+S7uLi4Le6z2KqFbFK83oyCi4u7hZsXlEJ3QVzSGxcXF3cPNy9V116taH6Li4v7NdzqYuW8bOXhS7OQ4eLijrnVoLO3HSpvb5JyhouLu4ybF7J8gVJd+hRKGy4u7q3cpKNeSFqdcFTIcHFxF3B7xat3optvnw5PfnBxcTdyL+s0KJFJEcTFxb2Lm8ed80OR6iWMD4EpLi7urdyrDmI/HJD0dmy4uLiLub2FTlLIepNpHrLi4uJeys2XI9UjkCR4zW9h4eLi7ufOu5sczRYyV1xc3GXcycWpZFGSBKaFsBUXF3cLt1dDJrFpsrnqBSi4uLjXcqvhRfI8L1iHrwAXF3cjdxKYVhc0k4NbXFzcb+aeh63zOPXiQoaLi7uRm29+erHsm/5xcXE3cvNrWOdLlknYGoUmuLi4W7jVUlKNRarhSPJScHFxl3F/AAwr2FeZYMOGAAAAAElFTkSuQmCC">分享</a><div class="tags"><a href="/tags/elk/">elk</a></div><div class="post-nav"><a class="pre" href="/2018/05/16/architec-initial/">初创期架构</a><a class="next" href="/2018/05/04/elk6-optimize/">大规模Elasticsearch集群优化管理</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.2"><script src="/js/gitment.browser.js?v=0.0.2"></script><script>var gitment = new Gitment({
  owner: 'young-0',
  repo: 'young-0.github.io',
  oauth: {
    client_id: '967eeda5599f16063a0a',
    client_secret: '0c5aaeec2649210043608d7a09c7d19f0795f3f9',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="yunke.science"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kubernetes/">Kubernetes</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/elk/">elk</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/fiction/">fiction</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jenkins/">jenkins</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/monitor/">monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/其他/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络/">网络</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/美文/">美文</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/elk/" style="font-size: 15px;">elk</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/openresty/" style="font-size: 15px;">openresty</a> <a href="/tags/LuaRocks/" style="font-size: 15px;">LuaRocks</a> <a href="/tags/fiction/" style="font-size: 15px;">fiction</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/架构/" style="font-size: 15px;">架构</a> <a href="/tags/crond/" style="font-size: 15px;">crond</a> <a href="/tags/alpine/" style="font-size: 15px;">alpine</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/monitor/" style="font-size: 15px;">monitor</a> <a href="/tags/Kubernetes/" style="font-size: 15px;">Kubernetes</a> <a href="/tags/jenkins/" style="font-size: 15px;">jenkins</a> <a href="/tags/kcptun/" style="font-size: 15px;">kcptun</a> <a href="/tags/zabbix/" style="font-size: 15px;">zabbix</a> <a href="/tags/kubernetes/" style="font-size: 15px;">kubernetes</a> <a href="/tags/情商/" style="font-size: 15px;">情商</a> <a href="/tags/智商/" style="font-size: 15px;">智商</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/其他/" style="font-size: 15px;">其他</a> <a href="/tags/proxy/" style="font-size: 15px;">proxy</a> <a href="/tags/traefik/" style="font-size: 15px;">traefik</a> <a href="/tags/网络/" style="font-size: 15px;">网络</a> <a href="/tags/美文/" style="font-size: 15px;">美文</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/03/01/v2ray-proxy/">V2Ray 配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/01/searx-search/">不需要安装软件，优雅使用google搜索</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/01/jenkins-role-auth/">Jenkins利用Role-based Authorization Strategy插件管理项目权限</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/16/k8s-pod-priority/">pod 优先级和抢占机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/05/pipeline-when/">jenkins pipeline when 内置判断条件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/24/k8s-job-monitor/">Kubernetes job monitor</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/22/expose-pod-info/">k8s通过文件将Pod信息暴露给容器的方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/29/weave-net/">weave-net</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/27/k8s-1-11-3-etcd/">Kubernetes 1.11.3 使用kubeadm创建高可用的ETCD群集</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/27/k8s-1-11-install/">Kubernetes 1.11.3 安装</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.21andy.com/manual/advanced-bash-scripting-guide/" title="高级Bash脚本编程指南" target="_blank">高级Bash脚本编程指南</a><ul></ul><a href="http://www.colasoft.com.cn/training/document.php" title="网络分析技术学习资料" target="_blank">网络分析技术学习资料</a><ul></ul><a href="https://k8smeetup.github.io/docs/home/" title="Kubernetes文档" target="_blank">Kubernetes文档</a><ul></ul><a href="https://www.bilibili.com/video/av21179285" title="TCPIP协议详解" target="_blank">TCPIP协议详解</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">天青色等烟雨.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.2" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.2" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" color="0,0,0" opacity="0.5" zindex="-2" count="50" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.2"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.2"></script></div></body></html>